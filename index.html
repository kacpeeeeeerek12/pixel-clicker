<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pixelowy Szał</title>
  <style>
    :root{
      --bg: #ffffff;
      --ink:#222;
      --accent:#2b8a3e;
      --accent-2:#3c6df0;
      --danger:#c92a2a;
      --muted:#8a8a8a;
      --px: 6px; /* pixel border size */
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; background:var(--bg); color:var(--ink); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      image-rendering: pixelated; /* make images/filters crunchy */
    }

    /* Layout */
    .app{ min-height:100%; display:flex; flex-direction:column; }
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px 16px; border-bottom: var(--px) solid #000; background:#f7f7f7;
    }
    .logo{ display:flex; align-items:center; gap:12px; }
    .logo img{ width:44px; height:44px; border: var(--px) solid #000; background:#ddd; object-fit:cover; image-rendering: pixelated; }
    .title{ font-weight:800; letter-spacing:0.5px; }
    .coins{ font-weight:800; }

    main{ flex:1; display:flex; align-items:center; justify-content:center; padding:16px; }
    .screen{ width:100%; max-width:1000px; min-height:540px; border: var(--px) solid #000; padding:16px; position:relative; background:#fafafa; }
    .center{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:16px; height:100%; text-align:center; }

    /* Pixel buttons */
    .btn{
      display:inline-block; min-width:160px; padding:14px 18px; font-size:18px; font-weight:900; text-transform:uppercase; letter-spacing:1px; text-align:center; cursor:pointer;
      background:#fff; color:#000; border: var(--px) solid #000; box-shadow: 0 var(--px) 0 #000; transition: transform .03s ease;
    }
    .btn:active{ transform: translateY(var(--px)); box-shadow: none; }
    .btn.primary{ background: #b7f7c1; border-color:#000; }
    .btn.blue{ background: #cbd8ff; }
    .btn.red{ background: #ffd2d2; }
    .btn.gray{ background: #eee; }
    .inline{ display:flex; gap:12px; flex-wrap:wrap; justify-content:center; }

    /* Main screen */
    .hero{ display:flex; flex-direction:column; align-items:center; gap:8px; }
    .selected-skin{
      width:182px; height:280px; /* preview size */
      border: var(--px) solid #000; background:#fff; position:relative; overflow:hidden;
    }
    .selected-skin img{ width:100%; height:100%; object-fit:contain; image-rendering: pixelated; }

    /* Game board */
    #gameBoard{
      position:relative; width:100%; height:520px; background:#fff; border: var(--px) dashed #000; overflow:hidden;
      cursor: crosshair;
    }
    .hud{ display:flex; justify-content:space-between; gap:8px; margin-bottom:8px; font-weight:800; }
    .char{
      position:absolute; width:291px; height:447px; /* 364x559 scaled -20% */
      /* Keep pixel-crisp scaling */
      image-rendering: pixelated;
      transform-origin:center; will-change: transform, left, top;
      animation: spin 3s linear infinite;
    }
    .char img{ width:100%; height:100%; object-fit:contain; image-rendering: pixelated; pointer-events:none; }
    @keyframes spin{ from{ transform: rotate(0deg); } to{ transform: rotate(360deg); } }

    /* Game over overlay */
    .overlay{ position:absolute; inset:0; display:none; align-items:center; justify-content:center; background: rgba(255,255,255,0.9); border: var(--px) solid #000; z-index:10; }
    .overlay.visible{ display:flex; }

    /* Shop & Wardrobe */
    .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:12px; }
    .card{ border: var(--px) solid #000; background:#fff; padding:10px; display:flex; flex-direction:column; gap:8px; }
    .skin-img{ width:100%; aspect-ratio: 182/280; border: var(--px) solid #000; background:#f5f5f5; display:flex; align-items:center; justify-content:center; }
    .skin-img img{ width:100%; height:100%; object-fit:contain; image-rendering: pixelated; }
    .pill{ display:inline-block; padding:4px 8px; border: var(--px) solid #000; background:#eee; font-weight:800; }

    footer{ padding:10px 16px; border-top: var(--px) solid #000; font-size:14px; color:var(--muted); }

    /* Hidden helper */
    .hidden{ display:none !important; }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">
      <img id="logoImg" src="logo_gry.png" alt="Logo" onerror="this.style.background='#ccc'" />
      <div class="title">PIXEL CLICKER</div>
    </div>
    <div class="coins">Monety: <span id="coins">0</span></div>
  </header>

  <main>
    <!-- MAIN MENU -->
    <section id="screen-main" class="screen">
      <div class="center">
        <div class="hero">
          <div class="selected-skin"><img id="mainSelected" alt="Wybrana postać" /></div>
          <div class="pill" id="activeName">—</div>
        </div>
        <div class="inline">
          <button class="btn primary" id="btnStart">Start</button>
          <button class="btn blue" id="btnShop">Sklep</button>
          <button class="btn" id="btnWardrobe">Szafa</button>
        </div>
      </div>
    </section>

    <!-- GAMEPLAY -->
    <section id="screen-game" class="screen hidden">
      <div class="hud">
        <div>Wynik: <span id="score">0</span></div>
        <div>Rekord: <span id="best">0</span></div>
        <div>Pudła: <span id="miss">0</span> / 5</div>
      </div>
      <div id="gameBoard">
        <div id="char" class="char"><img id="charImg" alt="postać" /></div>
        <div id="overlay" class="overlay">
          <div class="center">
            <div style="font-size:22px; font-weight:900;">Przegrana!</div>
            <div>Powrót za: <span id="countdown">3</span>…</div>
            <div class="inline" style="margin-top:12px;">
              <button class="btn" id="btnMainMenu">Ekran główny</button>
              <button class="btn primary" id="btnContinue">Graj dalej (5)</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SHOP -->
    <section id="screen-shop" class="screen hidden">
      <div class="center" style="align-items:stretch;">
        <h2 style="margin:0 0 8px 0;">Sklep</h2>
        <div class="grid" id="shopGrid"></div>
        <div class="inline" style="margin-top:8px;">
          <button class="btn" id="btnBackFromShop">Wróć</button>
        </div>
      </div>
    </section>

    <!-- WARDROBE -->
    <section id="screen-wardrobe" class="screen hidden">
      <div class="center" style="align-items:stretch;">
        <h2 style="margin:0 0 8px 0;">Szafa</h2>
        <div class="grid" id="wardrobeGrid"></div>
        <div class="inline" style="margin-top:8px;">
          <button class="btn" id="btnBackFromWardrobe">Wróć</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    Wszystko w stylu pixel‑art. Wklej grafiki do tego samego folderu i nadaj nazwy: <code>logo_gry.png</code>, <code>postac_1.png</code>…<code>postac_6.png</code>.
  </footer>
</div>

<script>
/**
 * === Pixel Clicker ===
 * Jednoplikowa gra HTML + CSS + JS.
 * Grafiki umieść w tym samym folderze co plik .html.
 * Nazwy:
 *   logo_gry.png
 *   postac_1.png – Katie (darmowa, trzeba odebrać w sklepie)
 *   postac_2.png – Clarck (200)
 *   postac_3.png – Mr. Bee (400)
 *   postac_4.png – Robot (600)
 *   postac_5.png – Kelly (900)
 *   postac_6.png – Patrick (1400)
 */

// --- Data ---
const CHARACTERS = [
  { id:1, key:'postac_1.png', name:'Katie', cost:0 },
  { id:2, key:'postac_2.png', name:'Clarck', cost:200 },
  { id:3, key:'postac_3.png', name:'Mr. Bee', cost:400 },
  { id:4, key:'postac_4.png', name:'Robot', cost:600 },
  { id:5, key:'postac_5.png', name:'Kelly', cost:900 },
  { id:6, key:'postac_6.png', name:'Patrick', cost:1400 },
];

// Simple persistent state in localStorage
const LS = {
  get(){
    const raw = localStorage.getItem('pxclicker');
    return raw ? JSON.parse(raw) : {
      coins: 0,
      owned: [], // ids
      selected: 1, // default placeholder; Katie still needs to be odebrana
      best: 0,
    };
  },
  set(data){ localStorage.setItem('pxclicker', JSON.stringify(data)); }
};
let state = LS.get();

// UI refs
const screens = {
  main: document.getElementById('screen-main'),
  game: document.getElementById('screen-game'),
  shop: document.getElementById('screen-shop'),
  wardrobe: document.getElementById('screen-wardrobe'),
};
const coinsEl = document.getElementById('coins');
const bestEl = document.getElementById('best');
const scoreEl = document.getElementById('score');
const missEl = document.getElementById('miss');
const mainSelectedImg = document.getElementById('mainSelected');
const activeName = document.getElementById('activeName');
const shopGrid = document.getElementById('shopGrid');
const wardrobeGrid = document.getElementById('wardrobeGrid');

// Buttons
const btnStart = document.getElementById('btnStart');
const btnShop = document.getElementById('btnShop');
const btnWardrobe = document.getElementById('btnWardrobe');
const btnBackFromShop = document.getElementById('btnBackFromShop');
const btnBackFromWardrobe = document.getElementById('btnBackFromWardrobe');

// Game elements
const gameBoard = document.getElementById('gameBoard');
const overlay = document.getElementById('overlay');
const countdownEl = document.getElementById('countdown');
const btnMainMenu = document.getElementById('btnMainMenu');
const btnContinue = document.getElementById('btnContinue');
const charBox = document.getElementById('char');
const charImg = document.getElementById('charImg');

// --- Helpers ---
function fmt(n){ return Math.floor(n); }
function setScreen(name){
  for(const k in screens){ screens[k].classList.toggle('hidden', k!==name); }
}
function updateHeader(){ coinsEl.textContent = state.coins; }
function updateMainSelected(){
  const skin = CHARACTERS.find(c=>c.id===state.selected) || CHARACTERS[0];
  mainSelectedImg.src = skin.key; mainSelectedImg.onerror = null; // just show empty if missing
  activeName.textContent = skin.name + (state.owned.includes(skin.id) || skin.cost===0 ? '' : ' (zablokowana)');
}
function save(){ LS.set(state); }

// --- Shop ---
function renderShop(){
  shopGrid.innerHTML = '';
  CHARACTERS.forEach(ch=>{
    const owned = state.owned.includes(ch.id);
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="skin-img"><img src="${ch.key}" alt="${ch.name}" onerror="this.style.background='#ddd'"/></div>
      <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
        <div style="font-weight:900;">${ch.name}</div>
        <div class="pill">${ch.cost===0? 'Darmowa' : ch.cost+' m'}</div>
      </div>
      <div class="inline">
        ${owned ? '<span class="pill">Zakupiono</span>' : `<button class="btn primary" data-buy="${ch.id}">${ch.cost===0?'Odbierz':'Kup'}</button>`}
        ${owned || ch.cost===0 ? `<button class="btn" data-equip="${ch.id}">Użyj</button>` : ''}
      </div>
    `;
    shopGrid.appendChild(card);
  });
}

shopGrid.addEventListener('click', (e)=>{
  const buyId = e.target.getAttribute('data-buy');
  const eqId = e.target.getAttribute('data-equip');
  if(buyId){
    const id = parseInt(buyId,10);
    const ch = CHARACTERS.find(c=>c.id===id);
    const already = state.owned.includes(id);
    if(already){ return; }
    if(ch.cost>0 && state.coins < ch.cost){ alert('Za mało monet!'); return; }
    if(ch.cost>0) state.coins -= ch.cost;
    // Katie (0) też trzeba odebrać => dodaj do owned
    state.owned.push(id);
    save(); updateHeader(); renderShop(); renderWardrobe();
  }
  if(eqId){
    const id = parseInt(eqId,10);
    const ch = CHARACTERS.find(c=>c.id===id);
    if(!ch) return;
    // Można wybrać tylko odblokowane (Katie po odebraniu)
    if(ch.cost===0 && !state.owned.includes(ch.id)){
      alert('Odbierz darmową Katie w sklepie.');
      return;
    }
    if(ch.cost>0 && !state.owned.includes(ch.id)){
      alert('Najpierw kup tę postać.');
      return;
    }
    state.selected = id; save(); updateMainSelected();
  }
});

// --- Wardrobe ---
function renderWardrobe(){
  wardrobeGrid.innerHTML = '';
  const unlocked = CHARACTERS.filter(ch=> ch.cost===0 ? state.owned.includes(ch.id) : state.owned.includes(ch.id));
  if(unlocked.length===0){
    wardrobeGrid.innerHTML = '<div class="pill">Pusto. Odblokuj postacie w sklepie.</div>';
    return;
  }
  unlocked.forEach(ch=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="skin-img"><img src="${ch.key}" alt="${ch.name}"/></div>
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div style="font-weight:900;">${ch.name}</div>
        ${state.selected===ch.id ? '<span class="pill">Aktywna</span>' : `<button class="btn" data-wear="${ch.id}">Wybierz</button>`}
      </div>
    `;
    wardrobeGrid.appendChild(card);
  });
}

wardrobeGrid.addEventListener('click', (e)=>{
  const id = e.target.getAttribute('data-wear');
  if(id){ state.selected = parseInt(id,10); save(); updateMainSelected(); renderWardrobe(); }
});

// --- Game Logic ---
let game = null;

function startGame(continueRun=false){
  setScreen('game');
  overlay.classList.remove('visible');

  // Init run state
  const best = state.best || 0; bestEl.textContent = best;
  let score = continueRun && game ? game.score : 0; scoreEl.textContent = score;
  let misses = continueRun && game ? game.misses : 0; missEl.textContent = misses;

  // Position and velocity
  const boardRect = gameBoard.getBoundingClientRect();
  const W = boardRect.width, H = boardRect.height;
  const cw = 291, ch = 447; // char size
  let x = Math.random()*(W-cw);
  let y = Math.random()*(H-ch);
  // start slow, speed up gradually
  let speed = continueRun && game ? game.speed : 90; // px/s
  let angle = Math.random()*Math.PI*2;
  let vx = Math.cos(angle)*speed;
  let vy = Math.sin(angle)*speed;
  const accel = 6; // px/s^2 gradual increase
  const maxSpeed = 520; // cap

  // Set image to selected character
  const skin = CHARACTERS.find(c=>c.id===state.selected) || CHARACTERS[0];
  // Only playable if owned (Katie must be claimed). If not, force to main & hint.
  const allowed = skin.cost===0 ? state.owned.includes(skin.id) : state.owned.includes(skin.id);
  charImg.src = skin.key;
  charBox.style.left = x+"px"; charBox.style.top = y+"px";

  // Click handlers
  function onHit(ev){
    ev.stopPropagation();
    score += 1; scoreEl.textContent = score;
    state.coins += 1; updateHeader(); save();
    // small knock to direction to keep it lively
    angle += (Math.random()*0.6 - 0.3);
    vx = Math.cos(angle)*speed;
    vy = Math.sin(angle)*speed;
  }
  function onMiss(){
    misses += 1; missEl.textContent = misses;
    if(misses>=5){
      gameOver();
    }
  }

  charBox.addEventListener('click', onHit);
  gameBoard.addEventListener('click', onMiss);

  // RAF loop
  let last = performance.now();
  let rafId = 0;
  function tick(now){
    const dt = (now - last)/1000; last = now;
    // increase speed
    speed = Math.min(maxSpeed, speed + accel*dt);
    vx = Math.cos(angle)*speed; vy = Math.sin(angle)*speed;
    x += vx*dt; y += vy*dt;
    // bounce
    if(x<=0){ x=0; angle = Math.PI - angle; }
    if(x+cw>=W){ x=W-cw; angle = Math.PI - angle; }
    if(y<=0){ y=0; angle = -angle; }
    if(y+ch>=H){ y=H-ch; angle = -angle; }

    charBox.style.left = x+"px"; charBox.style.top = y+"px";

    // update best
    if(score>state.best){ state.best = score; bestEl.textContent = score; save(); }

    rafId = requestAnimationFrame(tick);
  }

  function gameOver(){
    cancelAnimationFrame(rafId);
    charBox.removeEventListener('click', onHit);
    gameBoard.removeEventListener('click', onMiss);
    overlay.classList.add('visible');
    // store current run in case of paid continue
    game = { score, misses, speed };
    // countdown 3s back to menu if no action
    let t = 3; countdownEl.textContent = t;
    const timer = setInterval(()=>{
      t--; countdownEl.textContent = t;
      if(t<=0){ clearInterval(timer); setScreen('main'); }
    }, 1000);

    // continue button
    btnContinue.onclick = ()=>{
      if(state.coins < 5){ alert('Potrzeba 5 monet.'); return; }
      clearInterval(timer);
      overlay.classList.remove('visible');
      state.coins -= 5; updateHeader(); save();
      // reset lives but keep score & speed (slightly reduce for fairness)
      game.misses = 0; game.speed = Math.max(120, game.speed*0.85);
      startGame(true);
    };
    btnMainMenu.onclick = ()=>{ clearInterval(timer); setScreen('main'); };
  }

  // If selected skin not actually owned, block play and hint
  if(!allowed){
    alert('Najpierw odbierz Katie (darmowa) w sklepie albo wybierz odblokowaną postać w Szafie.');
    setScreen('main');
    charBox.removeEventListener('click', onHit);
    gameBoard.removeEventListener('click', onMiss);
    return;
  }

  rafId = requestAnimationFrame(tick);
}

// --- Wiring main screen buttons ---
btnStart.onclick = ()=> startGame(false);
btnShop.onclick = ()=>{ setScreen('shop'); renderShop(); };
btnWardrobe.onclick = ()=>{ setScreen('wardrobe'); renderWardrobe(); };
btnBackFromShop.onclick = ()=> setScreen('main');
btnBackFromWardrobe.onclick = ()=> setScreen('main');

// Initial paint
updateHeader();
updateMainSelected();
renderShop();
renderWardrobe();
</script>
</body>
</html>
